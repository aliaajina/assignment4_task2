---
title: "Assignment 4 Task 2"
author: "Alia Ajina"
date: "11/3/2021"
output: html_document
---

# Introduction

# Data and Analyses

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = TRUE)
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(kableExtra)
library(effsize)
library(broom)
```

# Juvenile Hare Initial Investigation

```{r, include = FALSE}
# Read in Bonanza Creek Hares data
bonanza <- read_csv(here("data", "bonanza_hares.csv"))
```

## Data Wrangling

```{r}
juvenile_hare <- bonanza %>% 
filter(age == "j") %>% 
mutate(date = mdy(date)) %>% 
mutate(year = year(date)) %>% 
group_by(year) %>% 
summarise(hare_count = n())
  
```

## Summary Statistics

Summarize the data and create a table of summary statistics 

```{r}
# Create table of summary stats
juvenile_hare_summary <- juvenile_hare %>% 
  summarise(mean_count = mean(hare_count, na.rm = TRUE), 
            median_count = median(hare_count, na.rm = TRUE), 
            sd_count = sd(hare_count, na.rm = TRUE), 
            max_count = max(hare_count, na.rm = TRUE),
            min_count = min(hare_count, na.rm = TRUE))
```

## Data Visualization

```{r}
# Create column graph
ggplot(data = juvenile_hare, 
       aes(x = year, y = hare_count)) +
# Change aesthetics accordingly
  geom_col(color = "light blue", fill = "light blue") +
  theme_minimal() +   
  scale_x_continuous(breaks = 1998:2012) +
  scale_y_continuous(breaks = c(0, 20, 40, 60, 80, 100, 120, 140)) +
  labs( x = "Year",
        y = "Number of Juvenile Hare Traps",
        caption = expression(paste(bold("Figure 1: "), "Total number of juvenile snowshoe hare trappings per year from 1998 to 2012 at Bonanza Creek Long Term Ecological Research site"))) +
# Adjust positioning
  theme(axis.text.x = element_text(size = 6, hjust = 0.5),
        axis.text.y = element_text(size = 6),
        axis.title.x = element_text(hjust = 0.5, 
                                    vjust = 0.5),
        plot.caption = element_text(hjust = .9), 
        legend.position = "none")
```

### Annual Juvenile Hare Trap Counts Outcomes:

The minimum count for juvenile hare trappings is `r juvenile_hare_summary$min_count` and the maximum is `r juvenile_hare_summary$max_count`. The mean annual number of juvenile hares trapped is `juvenile_hare_summary$mean_count` and the median is `r juvenile_hare_summary$median_count`. It appears that since 1999 the number of juvenile hares that have been trapped has decreased, although the trend is not profound. In the years 2005 and 2008 a small increase can be seen in the number of juvenile hares trapped in comparison to years prior. These counts, although absolute, are impacted by effort (number of days and number of traps in the study each year). Efforts for each year may have been uniform, or they may have varied greatly, which could have affected the data collected between 1999 to 2012. It would be beneficial to the study to quantify the number of observations recorded each year and standardize that number in future analyses in order to have accurate, standardized data that may better represent the true population of juvenile hares.

# Juvenile Hare Weights

## Data Wrangling

```{r}
hare_weights_sex <- bonanza %>% 
  filter(age == "j") %>% 
  mutate(full_grid = case_when(
    grid == "bonmat" ~ "Bonanza Mature",
    grid == "bonrip" ~ "Bonanza Riparian",
    grid == "bonbs" ~ "Bonanza Black Spruce")) %>% 
  mutate(full_sex = case_when(
    sex == "f" ~ "female",
    sex == "m" ~ "male",
    TRUE ~ "NA")) %>% 
  group_by(weight) %>% 
  summarize(full_sex, full_grid)
```

# Create summary statistics as well??????

## Data Visualization

```{r}
ggplot(data = hare_weights_sex, aes(x = weight, fill = full_sex)) +
  geom_histogram(aes(color = full_sex), bins = 15) +
  scale_fill_manual(values = c("pink", "blue", "black")) +
  scale_color_manual(values = c("white", "white", "white")) +
  facet_wrap(~ full_grid) +
  theme_grey() +
  labs(x = "Weight (g)",
       y = "Sex",
       caption = expression(paste(bold("Figure 2: "), "Distribution of juvenile hare weights in grams by sex and site at Bonanza Creek Long Term Ecological Research site. "))) +
  theme(axis.text.x = element_text(size = 6, hjust = 0.5),
        axis.text.y = element_text(size = 6),
        axis.title.x = element_text(hjust = 0.5, 
                                    vjust = 0.5),
        plot.caption = element_text(hjust = .8))
```


```{r}
ggplot(data = hare_weights_sex, aes(x = full_sex, y = weight)) +
  geom_jitter(aes(color = full_sex, 
                     fill = full_sex), bins = 10) +
  scale_fill_manual(values = c("pink", "blue", "black")) +
  scale_color_manual(values = c("pink", "blue", "black")) +
  facet_wrap(~ full_grid) +
  theme_grey() +
  labs(x = "Sex",
       y = "Weight (g)",
       caption = expression(paste(bold("Figure 2: "), "Distribution of juvenile hare weights in grams by sex and site at Bonanza Creek Long Term Ecological Research site. "))) +
  theme(axis.text.x = element_text(size = 6, hjust = 0.5),
        axis.text.y = element_text(size = 6),
        axis.title.x = element_text(hjust = 0.5, 
                                    vjust = 0.5),
        plot.caption = element_text(hjust = .8), 
        legend.position = "none")
```

>>>> HAVE TO REWRITE THIS TO SHOW REAL DISPLAY
On average at each of the sites; Bonanza Black Spruce, Bonanza Mature, and Bonanza Riparian, male and female juvenile hares have similar weight distributions. In the Bonanza Black Spruce site and the Bonanza Mature site, average male and female comparisons differ; females are slightly larger in the Bonanza Black Spruce site whereas they are slightly smaller in the Bonanza Mature site. Both the female and male juvenile hare weight is significantly larger at the Bonanza Riparian site in comparison to the other two sites. The NA juvenile hares that are present at Bonanza Mature and Bonanza Riparian are dramatically smaller than the female and male recorded weights at these sites. A possible hypothesis for this occurrence may be that the NA juvenile hares were too small for a sex to be determined. 

## Juvenile Weight Comparison

3. Juvenile weight comparison (male & female snowshoe hares). Further compare mean weights for **juvenile male and female snowshoe hares** included in this study. In this section, you should include:

A finalized table containing the mean, standard deviation, and sample size for male and female juvenile snowshoe hares, with a table caption (remember, a table caption should be placed *above* the table in your report)

```{r}
# Data wrangling
sex_weights_sum <- bonanza %>% 
  filter(age == "j") %>% 
  mutate(full_sex = case_when(
    sex == "f" ~ "Female",
    sex == "m" ~ "Male")) %>% 
  group_by(full_sex) %>% 
  summarise(weight)
  
# Create summary statistics
sex_weights_summary <- sex_weights_sum %>% 
  summarize(mean_weight =round(mean(weight, na.rm =TRUE), 2),
            median_weight = median(weight, na.rm = TRUE),
            sd_weight = round(sd(weight, na.rm = TRUE), 2),
            sample_size_weight = n())

# Finalized table:
sex_weights_summary %>% 
  kable(col.names = c( "Sex",
                      "Mean Weight (g)",
                      "Median Weight (g)",
                      "Standard Deviation (g)",
                      "Sample Size"),
        caption = "<center>Table 1: Summary statistics of male and female juvenile snowshoe hare's weight (g) at Bonanza Creek LTER<center>") %>% 
  kable_styling(bootstrap_options = "bordered",
                full_width = F, position = "center")

```

```{r, include = FALSE}
# Exploratory graphs to decide if using a t-test is appropriate

# Exploratory histogram
ggplot(data = sex_weights_sum, aes(x = weight)) +
  geom_histogram(bins = 10) +
  facet_wrap(~ full_sex)

# Exploratory QQ-plot
ggplot(data = sex_weights_sum, aes(sample = weight)) +
  stat_qq() + 
  stat_qq_line() +
  facet_wrap(~ full_sex)
```

## Means comparison

```{r}
# Means comparison

# Create female vector for means comparison
fem_weight <- sex_weights_sum %>% 
  filter(full_sex == "Female") %>% 
  drop_na(weight) %>% 
  pull(weight)

# Create male vector for means comparison
m_weight <- sex_weights_sum %>% 
  filter(full_sex == "Male") %>% 
  drop_na(weight) %>% 
  pull(weight)
```

### Cohen's D

```{r}
# Means comparison continued

# Run cohen's d for effect size
weight_effect <- cohen.d(fem_weight, m_weight)
# View effect size
weight_effect
```

### t-test

```{r}
# Means comparison continued

# Run a t-test
weight_t <- t.test(fem_weight, m_weight)
# View t-test results
weight_t
```

### Code for Actual Difference in Means

```{r}
# Run code to get the means and SDs for both female and male vectors in order to calculate the actual difference in means

fem_mean <- mean(fem_weight)
m_mean <- mean(m_weight)
fem_sd <- sd(fem_weight)
m_sd <- sd(m_weight)
```

A 2 - 3 sentence comprehensive statement of the means comparison, including at least:
The actual difference in means
Effect size (Cohen's *d*) (see effsize::cohen.d() example in the Lab 5 key)
Outcome of an unpaired two-sample t-test
 
Note: Exploratory graphs (e.g. histograms, QQ-plots) to explore assumptions of your t-test should not show up in your final knitted document, but you DO still need to create and think about them to determine whether a t-test is appropriate. If you want keep the code chunk containing those exploratory visualizations in your .Rmd but not appear in the knitted doc, you can add `include = FALSE` in the code chunk header.


4. Relationship between juvenile weight & hind foot length. Explore the relationship between juvenile snowshoe hare hind foot length (variable `hindft`, recorded in millimeters), and weight. Include all juvenile hares in the study. Create a final visualization of juvenile hare hind foot length versus weight. Include a figure caption.

```{r}
# Wrangle data to analyze relationship between juvenile weight and hind foot length
hare_weight_hindft <- bonanza %>%
filter(age == "j") %>% 
  select(hindft, weight)
```

```{r}
# Create a final visualization of juvenile har hind foot length vs weight
ggplot(data = hare_weight_hindft, aes(x = hindft, y = weight)) +
  geom_point(color = "blue", size = 2) +
  geom_smooth(method = "lm") +
  theme_grey() 
  
```

x =hndft y = weight
geom point, geom smooth
then linear regression below

```{r}
# Perform a linear regression to describe how juvenile showshoe hare weight changes with respect to hind foot length
hare_lm <- lm(weight ~ hindft, data = hare_weight_hindft)

# Use tidy to get a tidy output of lm
hare_lm_tidy <- tidy(hare_lm)
# Display tidy output of lm
hare_lm_tidy

# Use glance to get output of model fit & statistical significance
hare_lm_glance <- glance(hare_lm)
# Display output of model fit & statistical significance 
hare_lm_glance
```


Upon seeing your graph, your “boss” tells you to try out linear regression to describe how juvenile snowshoe hare weight changes with respect to hind foot length. Try it out (the only variables you are expected to include here are hind foot length and weight, using data for all juvenile hares in the data, e.g. you are not expected to explore impacts of sex, site, etc.), and check the model diagnostics.

In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you? 

# Summary: 
Include a very short summary describing your main findings from your juvenile hares exploration (bullet points are fine)

# Citations: 
Include citations (professionally formatted), including the data citation and any other resources that were references in your mini report. 

